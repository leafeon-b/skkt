# 権限ポリシー

## 本ドキュメントの目的

本ドキュメントは、各機能に対して「誰が実行できるか」を定義する。
業務ルール（`02_business_rules.md`）の前提のもとで、権限判断の一覧を提供する。

## 記号

- ✅: 許可
- ❌: 不許可
- -: 対象外（前提として主体が成立しない等）

## 主体（アクター）

- 登録済みユーザー: ログイン済みのユーザー（研究会・開催回の文脈がない操作の主体）
- 研究会参加者: 対象研究会に参加しているユーザー（CircleOwner / CircleManager / CircleMember のいずれか）
- 開催回参加者: 対象開催回に参加しているユーザー（CircleSessionOwner / CircleSessionManager / CircleSessionMember のいずれか）
- 非参加者: 対象リソースに参加していないユーザー

## ロールの前提

- 研究会参加者は、研究会ごとに必ず 1 つの研究会ロールを持つ（排他）
- 開催回参加者は、開催回ごとに必ず 1 つの開催回ロールを持つ（排他）
- ロール階層: Owner > Manager > Member
- Owner 移譲時、移譲元 Owner は Manager になる

## 注記

- `✅*` の操作は制約付きで許可される
  - **自分より上位のロールを持つ参加者に対して、ロール変更はできない**
  - 例: Manager は Owner のロールを変更できない

## 研究会（Circle）

### 研究会の文脈がない操作

| 操作                         | 登録済みユーザー |
| ---------------------------- | ---------------- |
| 研究会を作成                 | ✅               |
| 自分の参加している研究会一覧 | ✅               |

## ユーザー（User）

### ユーザーの閲覧

| 操作           | 登録済みユーザー |
| -------------- | ---------------- |
| ユーザーを閲覧 | ✅               |

### 既存研究会に対する操作

| 操作                       | CircleOwner | CircleManager | CircleMember | 非参加者 |
| -------------------------- | ----------- | ------------- | ------------ | -------- |
| 研究会を閲覧               | ✅          | ✅            | ✅           | ❌       |
| 研究会の詳細情報を編集     | ✅          | ✅            | ❌           | ❌       |
| 研究会を削除               | ✅          | ❌            | ❌           | ❌       |
| 研究会に参加者を追加       | ✅          | ✅            | ✅           | ❌       |
| 研究会参加者を削除         | ✅          | ✅            | ❌           | ❌       |
| 研究会参加者のロールを変更 | ✅          | ✅\*          | ❌           | ❌       |
| 研究会オーナーを移譲       | ✅          | ❌            | ❌           | ❌       |

## 開催回（CircleSession）

### 開催回の作成

| 操作                   | CircleOwner | CircleManager | CircleMember | 非参加者 |
| ---------------------- | ----------- | ------------- | ------------ | -------- |
| 開催回を作成           | ✅          | ✅            | ❌           | ❌       |
| 開催回を複製して作成   | ✅          | ✅            | ❌           | ❌       |

### 既存開催回に対する操作（閲覧）

| 操作         | 研究会参加者（いずれか） | 開催回参加者（いずれか） | 非参加者 |
| ------------ | ------------------------ | ------------------------ | -------- |
| 開催回を閲覧 | ✅                       | ✅                       | ❌       |

### 既存開催回に対する操作（管理）

| 操作                           | CircleSessionOwner | CircleSessionManager | CircleSessionMember | 非参加者 |
| ------------------------------ | ------------------ | -------------------- | ------------------- | -------- |
| 開催回の詳細情報を編集         | ✅                 | ✅                   | ❌                  | ❌       |
| 開催回を削除                   | ✅                 | ❌                   | ❌                  | ❌       |
| 開催回に参加者を追加           | ✅                 | ✅                   | ✅                  | ❌       |
| 開催回参加者を参加取消（除外） | ✅                 | ✅                   | ❌                  | ❌       |
| 開催回参加者のロールを変更     | ✅                 | ✅\*                 | ❌                  | ❌       |
| 開催回オーナーを移譲           | ✅                 | ❌                   | ❌                  | ❌       |

## 対局結果（Match）・編集履歴（MatchHistory）

| 操作                     | 研究会参加者（いずれか） | 開催回参加者（いずれか） | 非参加者 |
| ------------------------ | ------------------------ | ------------------------ | -------- |
| 対局結果を記録           | ✅                       | ✅                       | ❌       |
| 対局結果を閲覧           | ✅                       | ✅                       | ❌       |
| 対局結果を修正           | ✅                       | ✅                       | ❌       |
| 対局結果を削除           | ✅                       | ✅                       | ❌       |
| 対局結果の編集履歴を閲覧 | ✅                       | ✅                       | ❌       |
